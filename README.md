# Проект dbt_test_bq: Анализ чаевых в такси Чикаго

Этот проект демонстрирует, как с помощью **dbt (data build tool)** получать и обрабатывать данные из публичного датасета [BigQuery Public Datasets](https://console.cloud.google.com/marketplace/details/bigquery-public-data/chicago-taxi-trips) о поездках на такси в Чикаго. 

Задача:
1. Найти **3 машины**, которые получили **наибольшее количество чаевых в апреле 2018**.
2. Вывести, как менялась сумма чаевых в **процентах** к предыдущему месяцу (динамика).
3. Результат содержит колонки:  
   - `taxi_id`  
   - `year_month`  
   - `tips_sum`  
   - `tips_change`  

## Структура слоёв (Models)

В проекте модели разнесены на три слоя:

1. **Staging**:  
   - Сырые данные из `bigquery-public-data.chicago_taxi_trips`, фильтруем нужные поля, приводим типы.  
   - Пример: `stg_chicago_taxi.sql` (view).

2. **Intermediate**:  
   - Агрегации и промежуточные расчёты.  
   - Пример: `int_monthly_tips.sql` (table) — суммирует чаевые по `(taxi_id, month)`.

3. **Marts**:  
   - Финальные модели/«витрины» для бизнес-анализа.  
   - Пример: `fct_top3_tips_monthly.sql` (incremental) — находит топ-3 такси и считает динамику чаевых.

## Как запустить

1. Убедитесь, что dbt установлен и настроен (локально или в dbt Cloud).
2. Проверьте подключение к BigQuery (должен быть указан проект и датасет, где будут созданы модели).
3. Склонируйте репозиторий и перейдите в папку проекта:
   ```bash
   git clone <URL_этого_репозитория>.git
   cd dbt_test_bq